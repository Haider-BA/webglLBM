
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - render-to-texture</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				color: #ffffff;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				font-weight: bold;
				background-color: #000000;
				margin: 0px;
				overflow: hidden;
			}

			#info {
				position: absolute;
				top: 300px; width: 100%;
				padding: 5px;
			}

			a {
				color: #ffffff;
			}

		</style>
	</head>
	<body>
		<div id="container"></div>
		<div id="info"><a href="https://github.com/yhenon/webglLBM" target="_blank">webglLBM</a> LBM implemented in webGL with ThreeJS</div>

		<script src="./js/three.min.js"></script>

		<script src="./js/Detector.js"></script>
		<script src="./js/stats.min.js"></script>

		<script id="fragmentCompute1" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform highp sampler2D tDiffuse1;
			uniform highp sampler2D tDiffuse2;
			uniform highp sampler2D tDiffuse3;
			uniform highp float currTime;

			void main() {
				float omega=0.25; 
				//float density=1.0; 
				float t1=4./9.; 
				float t2=1./9.; 
				float t3=1./36.; 
				float c_squ=1./3.;

				vec4 v1 = texture2D( tDiffuse1, vUv);
				vec4 v2 = texture2D( tDiffuse2, vUv);
				vec4 v3 = texture2D( tDiffuse3, vUv);

				float f1 = v1.r;
				float f2 = v1.g;
				float f3 = v1.b;
				 
				float f4 = v2.r;
				float f5 = v2.g;
				float f6 = v2.b;
				 
				float f7 = v3.r;
				float f8 = v3.g;
				float f9 = v3.b;
				
				float density = f1+f2+f3+f4+f5+f6+f7+f8+f9;
				float invDensity = 1./ density;
				float ux = invDensity *(f1+f2+f8-f4-f5-f6);
				float uy = invDensity *(f2+f3+f4-f6-f7-f8);
				if (currTime < 0.1 && (vUv.x < 0.002 )) {
					ux += .02;
				};
				float usqu = ux*ux + uy*uy;
				float uc2 = ux+uy;
				float uc4 = -ux+uy;
				float uc6 = -uc2;
				float uc8 = -uc4;
 
				float feq1 = t2*density*(1. + ux/c_squ+0.5*(ux/c_squ)*(ux/c_squ)- usqu/(2.*c_squ));
				float feq3 = t2*density*(1. + uy/c_squ+0.5*(uy/c_squ)*(uy/c_squ) - usqu/(2.*c_squ));
				float feq5 = t2*density*(1. - ux/c_squ+0.5*(ux/c_squ)*(ux/c_squ)- usqu/(2.*c_squ));
				float feq7 = t2*density*(1. - uy/c_squ+0.5*(uy/c_squ)*(uy/c_squ) - usqu/(2.*c_squ));
 
				float feq2 = t3*density*(1. + uc2/c_squ+0.5*(uc2/c_squ)*(uc2/c_squ)- usqu/(2.*c_squ));
				float feq4 = t3*density*(1. + uc4/c_squ+0.5*(uc4/c_squ)*(uc4/c_squ)- usqu/(2.*c_squ));
				float feq6 = t3*density*(1. + uc6/c_squ+0.5*(uc6/c_squ)*(uc6/c_squ)- usqu/(2.*c_squ));
				float feq8 = t3*density*(1. + uc8/c_squ+0.5*(uc8/c_squ)*(uc8/c_squ)- usqu/(2.*c_squ));
 
				float feq9 = t1*density*(1. - usqu/(2.*c_squ));

				float ff1 = omega * feq1 + (1. - omega) * f1;
				float ff2 = omega * feq2 + (1. - omega) * f2;
				float ff3 = omega * feq3 + (1. - omega) * f3;
					
				gl_FragColor = vec4(ff1,ff2,ff3,1.);

			}

		</script>
		<script id="fragmentCompute2" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform highp sampler2D tDiffuse1;
			uniform highp sampler2D tDiffuse2;
			uniform highp sampler2D tDiffuse3;
			uniform highp float currTime;


			void main() {
				float omega=0.25; 
				//float density=1.0; 
				float t1=4./9.; 
				float t2=1./9.; 
				float t3=1./36.; 
				float c_squ=1./3.;

				vec4 v1 = texture2D( tDiffuse1, vUv);
				vec4 v2 = texture2D( tDiffuse2, vUv);
				vec4 v3 = texture2D( tDiffuse3, vUv);
				float f1 = v1.r;
				float f2 = v1.g;
				float f3 = v1.b;
				 
				float f4 = v2.r;
				float f5 = v2.g;
				float f6 = v2.b;
				 
				float f7 = v3.r;
				float f8 = v3.g;
				float f9 = v3.b;
				
				float density = f1+f2+f3+f4+f5+f6+f7+f8+f9;
				float invDensity = 1./ density;
				float ux = invDensity *(f1+f2+f8-f4-f5-f6);
				float uy = invDensity *(f2+f3+f4-f6-f7-f8);				
				if (currTime < 0.1 && (vUv.x < 0.002 )) {
					ux += .02;
				};
				float usqu = ux*ux + uy*uy;
				float uc2 = ux+uy;
				float uc4 = -ux+uy;
				float uc6 = -uc2;
				float uc8 = -uc4;

				float feq1 = t2*density*(1. + ux/c_squ+0.5*(ux/c_squ)*(ux/c_squ)- usqu/(2.*c_squ));
				float feq3 = t2*density*(1. + uy/c_squ+0.5*(uy/c_squ)*(uy/c_squ) - usqu/(2.*c_squ));
				float feq5 = t2*density*(1. - ux/c_squ+0.5*(ux/c_squ)*(ux/c_squ)- usqu/(2.*c_squ));
				float feq7 = t2*density*(1. - uy/c_squ+0.5*(uy/c_squ)*(uy/c_squ) - usqu/(2.*c_squ));

				float feq2 = t3*density*(1. + uc2/c_squ+0.5*(uc2/c_squ)*(uc2/c_squ)- usqu/(2.*c_squ));
				float feq4 = t3*density*(1. + uc4/c_squ+0.5*(uc4/c_squ)*(uc4/c_squ)- usqu/(2.*c_squ));
				float feq6 = t3*density*(1. + uc6/c_squ+0.5*(uc6/c_squ)*(uc6/c_squ)- usqu/(2.*c_squ));
				float feq8 = t3*density*(1. + uc8/c_squ+0.5*(uc8/c_squ)*(uc8/c_squ)- usqu/(2.*c_squ));

				float feq9 = t1*density*(1. - usqu/(2.*c_squ));
				
				float ff4 = omega * feq4 + (1. - omega) * f4;
				float ff5 = omega * feq5 + (1. - omega) * f5;
				float ff6 = omega * feq6 + (1. - omega) * f6;

				gl_FragColor = vec4(ff4,ff5,ff6,1.);

			}

		</script>
		<script id="fragmentCompute3" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform highp sampler2D tDiffuse1;
			uniform highp sampler2D tDiffuse2;
			uniform highp sampler2D tDiffuse3;
			uniform highp float currTime;


			void main() {
				float omega=0.25; 
				//float density=1.0; 
				float t1=4./9.; 
				float t2=1./9.; 
				float t3=1./36.; 
				float c_squ=1./3.;

				vec4 v1 = texture2D( tDiffuse1, vUv);
				vec4 v2 = texture2D( tDiffuse2, vUv);
				vec4 v3 = texture2D( tDiffuse3, vUv);
				float f1 = v1.r;
				float f2 = v1.g;
				float f3 = v1.b;
				 
				float f4 = v2.r;
				float f5 = v2.g;
				float f6 = v2.b;
				 
				float f7 = v3.r;
				float f8 = v3.g;
				float f9 = v3.b;
				
				float density = f1+f2+f3+f4+f5+f6+f7+f8+f9;
				float invDensity = 1./ density;
				float ux = invDensity *(f1+f2+f8-f4-f5-f6);
				float uy = invDensity *(f2+f3+f4-f6-f7-f8);
				if (currTime < 0.1 && (vUv.x < 0.002 )) {
					ux += .02;
				};
				float usqu = ux*ux + uy*uy;
				float uc2 = ux+uy;
				float uc4 = -ux+uy;
				float uc6 = -uc2;
				float uc8 = -uc4;

				float feq1 = t2*density*(1. + ux/c_squ+0.5*(ux/c_squ)*(ux/c_squ) - usqu/(2.*c_squ));
				float feq3 = t2*density*(1. + uy/c_squ+0.5*(uy/c_squ)*(uy/c_squ) - usqu/(2.*c_squ));
				float feq5 = t2*density*(1. - ux/c_squ+0.5*(ux/c_squ)*(ux/c_squ) - usqu/(2.*c_squ));
				float feq7 = t2*density*(1. - uy/c_squ+0.5*(uy/c_squ)*(uy/c_squ) - usqu/(2.*c_squ));
 
				float feq2 = t3*density*(1. + uc2/c_squ+0.5*(uc2/c_squ)*(uc2/c_squ) - usqu/(2.*c_squ));
				float feq4 = t3*density*(1. + uc4/c_squ+0.5*(uc4/c_squ)*(uc4/c_squ) - usqu/(2.*c_squ));
				float feq6 = t3*density*(1. + uc6/c_squ+0.5*(uc6/c_squ)*(uc6/c_squ) - usqu/(2.*c_squ));
				float feq8 = t3*density*(1. + uc8/c_squ+0.5*(uc8/c_squ)*(uc8/c_squ) - usqu/(2.*c_squ));
 
				float feq9 = t1*density*(1. - usqu/(2.*c_squ));

				float ff7 = omega * feq7 + (1. - omega) * f7;
				float ff8 = omega * feq8 + (1. - omega) * f8;
				float ff9 = omega * feq9 + (1. - omega) * f9;				

				gl_FragColor = vec4(ff7,ff8,ff9,1.);

			}

		</script>				
		<script id="fragmentCopy1" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform highp sampler2D tDiffuse1;

			void main() {
				gl_FragColor = texture2D( tDiffuse1, vUv );

			}

		</script>
		<script id="fragmentCopy2" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform highp sampler2D tDiffuse2;

			void main() {
				gl_FragColor = texture2D( tDiffuse2, vUv );

			}

		</script>
		<script id="fragmentCopy3" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform highp sampler2D tDiffuse3;

			void main() {
				gl_FragColor = texture2D( tDiffuse3, vUv );

			}

		</script>		
		<script id="fragmentShow" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform highp sampler2D tDiffuse1;
			uniform highp sampler2D tDiffuse2;
			uniform highp sampler2D tDiffuse3;

			void main() {
				vec4 v1 = texture2D( tDiffuse1, vUv );
				vec4 v2 = texture2D( tDiffuse2, vUv );
				vec4 v3 = texture2D( tDiffuse3, vUv );

				float f1 = v1.r;
				float f2 = v1.g;
				float f3 = v1.b;
				float f4 = v2.r;
				float f5 = v2.g;
				float f6 = v2.b;				 
				float f7 = v3.r;
				float f8 = v3.g;

				float ux = f1+f2+f8-f4-f5-f6;
				float uy = f2+f3+f4-f6-f7-f8;
				float velmag = 40000.*sqrt(uy*uy);// 10.*sqrt(1.*uy*uy+1.*ux*ux);
				//if (velmag > 1.) { velmag = 1; };
				gl_FragColor = vec4(velmag, 0,1.-velmag, 1.);
				//gl_FragColor = vec4(velmag, 0., 1. - velmag, 1.);


			}

		</script>

		<script id="fragmentStep1" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform float time;
			uniform float dt;
			uniform highp sampler2D tDiffuse3;

			void main() {

				if (time  == 0. )  {
					gl_FragColor = vec4(1./9.,1./9.,1./9.,1.);
				} else {
					float h = - dt;
					//vec4 fVec = texture2D( tDiffuse3, vUv + vec2(h,0.));
					float f1 = texture2D( tDiffuse3, vUv + vec2(h,0)).r;
					float f2 = texture2D( tDiffuse3, vUv + vec2(h,h)).g;
					float f3 = texture2D( tDiffuse3, vUv + vec2(0,h)).b;

					gl_FragColor = vec4(f1, f2, f3 ,1.);
				}

			}

		</script>
		<script id="fragmentStep2" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform float time;
			uniform float dt;
			uniform highp sampler2D tDiffuse3;

			void main() {

				if (time  == 0. )  {
					gl_FragColor = vec4(1./9.,1./9.,1./9.,1.);
				} else {
					float h = - dt;
					float f4 = texture2D( tDiffuse3, vUv + vec2(-h,h)).r;
					float f5 = texture2D( tDiffuse3, vUv + vec2(-h,0)).g;
					float f6 = texture2D( tDiffuse3, vUv + vec2(-h,-h)).b;

					gl_FragColor = vec4(f4, f5, f6 ,1.);
				}

			}

		</script>
		<script id="fragmentStep3" type="x-shader/x-fragment">
			precision highp float;
			precision highp int;

			varying vec2 vUv;
			uniform float time;
			uniform float dt;
			uniform highp sampler2D tDiffuse3;

			void main() {

				if (time  == 0. ) {
					gl_FragColor = vec4(1./9.,1./9.,1./9.,1.);
				} else {
					float h = - dt;
					float f7 = texture2D( tDiffuse3, vUv + vec2(0,-h)).r;
					float f8 = texture2D( tDiffuse3, vUv + vec2(h,-h)).g;
					float f9 = texture2D( tDiffuse3, vUv).b;

					gl_FragColor = vec4(f7, f8, f9 ,1.);
				}

			}

		</script>		
		<script id="vertexShader" type="x-shader/x-vertex">
			precision highp float;
			precision highp int;

			varying vec2 vUv;

			void main() {

				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			}

		</script>


		<script>

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var container, stats, materialCopy, materialStep, materialShow;

			var cameraRTT, camera, sceneStep1, sceneStep2, sceneStep3, sceneShow, scene, renderer, zmesh1, zmesh2, sceneCopy1, sceneCopy2, sceneCopy3;
			var sceneCompute1, sceneCompute2 , sceneCompute3  ;

			var mouseX = 0, mouseY = 0;

			var material, quad;

			var rtTexture1, rtTexture2, rtTexture3;
			var rtTexture1c, rtTexture2c, rtTexture3c;
			

			var delta = 0.002;

			init();
			animate();
			//var customWindow;
			function init() {

				container = document.getElementById( 'container' );
				customWindow = Object();
				customWindow.innerWidth = 256;
				customWindow.innerHeight = 256;
				cameraRTT = new THREE.OrthographicCamera( customWindow.innerWidth / - 2, customWindow.innerWidth / 2, customWindow.innerHeight / 2, customWindow.innerHeight / - 2, -1000, 1000 );
				cameraRTT.position.z = 100;

				sceneStep1 = new THREE.Scene();
				sceneCopy1 = new THREE.Scene();
				sceneStep2 = new THREE.Scene();
				sceneCopy2 = new THREE.Scene();
				sceneStep3 = new THREE.Scene();
				sceneCopy3 = new THREE.Scene();
				sceneCompute1 = new THREE.Scene();
				sceneCompute2 = new THREE.Scene();
				sceneCompute3 = new THREE.Scene();
				sceneShow = new THREE.Scene();

				rtTexture1 = new THREE.WebGLRenderTarget( customWindow.innerWidth, customWindow.innerHeight, { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat, type: THREE.FloatType } );
				rtTexture2 = new THREE.WebGLRenderTarget( customWindow.innerWidth, customWindow.innerHeight, { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat, type: THREE.FloatType } );
				rtTexture3 = new THREE.WebGLRenderTarget( customWindow.innerWidth, customWindow.innerHeight, { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat, type: THREE.FloatType } );
				rtTexture1c = new THREE.WebGLRenderTarget( customWindow.innerWidth, customWindow.innerHeight, { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat, type: THREE.FloatType } );
				rtTexture2c = new THREE.WebGLRenderTarget( customWindow.innerWidth, customWindow.innerHeight, { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat, type: THREE.FloatType } );
				rtTexture3c = new THREE.WebGLRenderTarget( customWindow.innerWidth, customWindow.innerHeight, { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat, type: THREE.FloatType } );

				rtTexture1.wrapS = THREE.RepeatWrapping;
				rtTexture1.wrapT = THREE.RepeatWrapping;
				
				rtTexture2.wrapS = THREE.RepeatWrapping;
				rtTexture2.wrapT = THREE.RepeatWrapping;
				
				rtTexture3.wrapS = THREE.RepeatWrapping;
				rtTexture3.wrapT = THREE.RepeatWrapping;
				
				rtTexture1c.wrapS = THREE.RepeatWrapping;
				rtTexture1c.wrapT = THREE.RepeatWrapping;
				
				rtTexture2c.wrapS = THREE.RepeatWrapping;
				rtTexture2c.wrapT = THREE.RepeatWrapping;
				
				rtTexture3c.wrapS = THREE.RepeatWrapping;
				rtTexture3c.wrapT = THREE.RepeatWrapping;
				
				materialShow = new THREE.ShaderMaterial( {

					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentShow' ).textContent,
					uniforms: {tDiffuse1: { type: "t", value: rtTexture1c },tDiffuse2: { type: "t", value: rtTexture2c },tDiffuse3: { type: "t", value: rtTexture3c }  } }
				);

				materialCompute1 = new THREE.ShaderMaterial( {

					uniforms: { tDiffuse1: { type: "t", value: rtTexture1 } , currTime: {type: "f", value:0} ,
					tDiffuse2: { type: "t", value: rtTexture2 },
					tDiffuse3: { type: "t", value: rtTexture3 } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentCompute1' ).textContent,

				} );
				materialCompute2 = new THREE.ShaderMaterial( {

					uniforms: {tDiffuse1: { type: "t", value: rtTexture1 } , currTime: {type: "f", value:0},
					tDiffuse2: { type: "t", value: rtTexture2 },
					tDiffuse3: { type: "t", value: rtTexture3 } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentCompute2' ).textContent,

				} );			
				materialCompute3 = new THREE.ShaderMaterial( {

					uniforms: {tDiffuse1: { type: "t", value: rtTexture1 } ,currTime: {type: "f", value:0},
					tDiffuse2: { type: "t", value: rtTexture2 },
					tDiffuse3: { type: "t", value: rtTexture3 } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentCompute3' ).textContent,

				} );

				materialStep1 = new THREE.ShaderMaterial( {

					uniforms: { time: { type: "f", value: 0.0 } , dt: { type: "f", value: 0.1},
					tDiffuse3: { type: "t", value: rtTexture1 } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentStep1' ).textContent,

					depthWrite: false

				} );
				materialStep2 = new THREE.ShaderMaterial( {

					uniforms: { time: { type: "f", value: 0.0 } , dt: { type: "f", value: 0.1},
					tDiffuse3: { type: "t", value: rtTexture2 } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentStep2' ).textContent,

					depthWrite: false

				} );
				materialStep3 = new THREE.ShaderMaterial( {

					uniforms: { time: { type: "f", value: 0.0 } , dt: { type: "f", value: 0.1},
					tDiffuse3: { type: "t", value: rtTexture3 } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentStep3' ).textContent,

					depthWrite: false

				} );								
				materialCopy1 = new THREE.ShaderMaterial( {

					uniforms: { tDiffuse1: { type: "t", value: rtTexture1c } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentCopy1' ).textContent,

					depthWrite: false

				} );				
				materialCopy2 = new THREE.ShaderMaterial( {

					uniforms: { tDiffuse2: { type: "t", value: rtTexture2c } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentCopy2' ).textContent,

					depthWrite: false

				} );	
				materialCopy3 = new THREE.ShaderMaterial( {

					uniforms: { tDiffuse3: { type: "t", value: rtTexture3c } },
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentCopy3' ).textContent,

					depthWrite: false

				} );		

				var plane = new THREE.PlaneBufferGeometry( customWindow.innerWidth, customWindow.innerHeight );

				quad = new THREE.Mesh( plane, materialStep1 );
				sceneStep1.add( quad );
				quad = new THREE.Mesh( plane, materialStep2 );
				sceneStep2.add( quad );
				quad = new THREE.Mesh( plane, materialStep3 );
				sceneStep3.add( quad );

				quad = new THREE.Mesh( plane, materialCopy1 );
				sceneCopy1.add( quad );
				quad = new THREE.Mesh( plane, materialCopy2 );
				sceneCopy2.add( quad );
				quad = new THREE.Mesh( plane, materialCopy3 );
				sceneCopy3.add( quad );

				quad = new THREE.Mesh( plane, materialCompute1 );
				sceneCompute1.add( quad );
				quad = new THREE.Mesh( plane, materialCompute2 );
				sceneCompute2.add( quad );				
				quad = new THREE.Mesh( plane, materialCompute3 );
				sceneCompute3.add( quad );

				quad = new THREE.Mesh( plane, materialShow );
				sceneShow.add( quad );

				renderer = new THREE.WebGLRenderer();
				renderer.setSize( customWindow.innerWidth, customWindow.innerHeight );
				renderer.autoClear = false;

				materialStep1.uniforms.dt.value  = 1. / customWindow.innerHeight;
				materialStep2.uniforms.dt.value  = 1. / customWindow.innerHeight;
				materialStep3.uniforms.dt.value  = 1. / customWindow.innerHeight;

				container.appendChild( renderer.domElement );

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				container.appendChild( stats.domElement );

			}

			function animate() {

				requestAnimationFrame( animate );

				render();
				stats.update();

			}

			function render() {

				//var time = Date.now() * 0.0015;
				renderer.clear();

				// Render first scene into texture

				renderer.render( sceneStep1, cameraRTT, rtTexture1c, true );
				renderer.render( sceneCopy1, cameraRTT, rtTexture1, true );
				
				renderer.render( sceneStep2, cameraRTT, rtTexture2c, true );
				renderer.render( sceneCopy2, cameraRTT, rtTexture2, true );
				
				renderer.render( sceneStep3, cameraRTT, rtTexture3c, true );
				renderer.render( sceneCopy3, cameraRTT, rtTexture3, true );


				renderer.render( sceneCompute1, cameraRTT, rtTexture1c, true );
				renderer.render( sceneCompute2, cameraRTT, rtTexture2c, true );
				renderer.render( sceneCompute3, cameraRTT, rtTexture3c, true );

				renderer.render( sceneCopy1, cameraRTT, rtTexture1, true );
				renderer.render( sceneCopy2, cameraRTT, rtTexture2, true );
				renderer.render( sceneCopy3, cameraRTT, rtTexture3, true );

				// Render full screen quad with generated texture

				renderer.render( sceneShow, cameraRTT );

				materialStep1.uniforms.time.value += delta;
				materialStep2.uniforms.time.value += delta;
				materialStep3.uniforms.time.value += delta;

				materialCompute1.uniforms.currTime.value += delta;
				materialCompute2.uniforms.currTime.value += delta;
				materialCompute3.uniforms.currTime.value += delta;

			}

		</script>
	</body>
</html>
